!function(t,e,i){"use strict";var n={},o={},r=0,h=function(){o={top:document.documentElement.clientTop,left:document.documentElement.clientLeft},n=new d(t.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft,t.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,t.innerWidth,t.innerHeight)},s=function(t,e,i){for(var n=t===f.BooleanMode.AND,o=0;o<e.length;o++)t===f.BooleanMode.AND?n&=i(e[o]):n|=i(e[o]);return!!n},a=function(t){return!!n.intersectionWith(t)},c=function(e){return"string"==typeof e?document.querySelectorAll(e):t.jQuery&&e instanceof jQuery?jQuery.makeArray(e):e.length!==i&&"function"!=typeof e?e:e.nodeType?[e]:null},d=function(t,e,i,n){this.left=Math.round(t),this.top=Math.round(e),this.width=Math.round(i),this.height=Math.round(n),this.right=this.left+this.width,this.bottom=this.top+this.height},u={area:{}};u.area.get=function(){return this.width*this.height},d.prototype.subtractFrom=function(t){return new d(this.left-t.left,this.top-t.top,this.width,this.height)},d.prototype.intersectionWith=function(t){var e=Math.max(this.top,t.top),i=Math.max(this.left,t.left),n=Math.min(this.right,t.right),o=Math.min(this.bottom,t.bottom),r=n-i,h=o-e;return r>=0&&h>=0?new d(i,e,r,h):null},d.getOffsetRect=function(t){var e=t.getBoundingClientRect(),i=e.top+n.top-o.top,r=e.left+n.left-o.left;return new d(r,i,e.width,e.height)},Object.defineProperties(d.prototype,u);var l=function(){"function"==typeof this.callback&&this.callback.call(this,this.getState(this.nodes))},f=function(){this.nodes=[],this.binded=!1,this.callback=null},p={numberOfInstances:{}};f.prototype.bind=function(e,i){if(r++||(t.addEventListener("resize",h),t.addEventListener("scroll",h)),"function"!=typeof i)throw"[Visc: Invalid Callback]";return this.callback=i,this.nodes=c(e),this.binded=!0,t.addEventListener("resize",l.bind(this)),t.addEventListener("scroll",l.bind(this)),this},f.prototype.unbind=function(){return this.binded=!1,t.removeEventListener("resize",l.bind(this)),t.removeEventListener("scroll",l.bind(this)),--r||(t.removeEventListener("resize",h),t.removeEventListener("scroll",h)),this},f.prototype.getState=function(t){var e=this;if(!t)return null;this.nodes.length||(this.nodes=c(t)),r||h();for(var i=[],o=0;o<this.nodes.length;o++){var s=e.nodes[o],u=d.getOffsetRect(s),l=u.intersectionWith(n),f=u.area,p={node:s,onScreen:a(u),visibilityRate:{both:0,horizontal:0,vertical:0},occupiedViewport:{both:0,horizontal:0,vertical:0},maxVisibility:{both:0,horizontal:0,vertical:0},frames:{window:new d(0,0,0,0),viewport:new d(0,0,0,0),node:new d(0,0,0,0)}};if(l&&0!==u.width&&0!==u.height){var m=l.area,b=Math.min(u.width,n.width),v=Math.min(u.height,n.height);p.frames={window:l,viewport:l.subtractFrom(n),node:l.subtractFrom(u)},p.visibilityRate={both:m/f,horizontal:l.width/u.width,vertical:l.height/u.height},p.occupiedViewport={both:m/n.area,horizontal:l.width/n.width,vertical:l.height/n.height},p.maxVisibility={both:m/(b*v),horizontal:l.width/b,vertical:l.height/v}}i.push(p)}return i},p.numberOfInstances.get=function(){return r},f.getState=function(t){return(new f).getState(t)},f.isVisible=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=f.BooleanMode.AND),s(i,f.getState(t),function(t){var i=t.maxVisibility.both;return i>0&&i>=e||1===i})},f.isOnScreen=function(t,e){return void 0===e&&(e=f.BooleanMode.AND),h(),s(e,c(t),function(t){return a(d.getOffsetRect(t))})},Object.defineProperties(f,p),f.BooleanMode={AND:0,OR:1},e&&(e.fn.visc=function(t){if("getState"===t)return f.getState(this);if("function"==typeof t){var i=new f;return this.data("visc",i),i.bind(this,arguments[0]),this}e.error('Method "'+t+'" does not exist on $.ViSC')},e.fn.unvisc=function(){return this.data("visc").unbind(),this}),"undefined"!=typeof module&&module.exports?module.exports=f:t.Visc=f}(window,window.jQuery||window.Zepto||window.$);